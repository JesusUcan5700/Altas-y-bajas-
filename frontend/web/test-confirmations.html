<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Confirmaciones de Edici贸n</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-12">
                <h2 class="mb-4"><i class="fas fa-test-tube me-2"></i>Prueba de Confirmaciones de Edici贸n</h2>
                
                <div class="alert alert-info">
                    <i class="fas fa-info-circle me-2"></i>
                    <strong>Sistema Actualizado:</strong> Ahora el formulario <strong>SOLO</strong> se guarda cuando presiones "S铆" en la confirmaci贸n. 
                    <strong>No se guarda autom谩ticamente.</strong>
                </div>

                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <strong>Importante:</strong> Todas las confirmaciones deben ser expl铆citas. Si cancelas, los cambios NO se guardar谩n.
                </div>

                <!-- Formulario de prueba para equipos -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-desktop me-2"></i>Prueba - Editar Equipo</h5>
                    </div>
                    <div class="card-body">
                        <form id="test-form-equipo" data-tipo="equipo">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="marca" class="form-label">Marca</label>
                                        <input type="text" class="form-control" id="marca" name="marca" value="HP">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="modelo" class="form-label">Modelo</label>
                                        <input type="text" class="form-control" id="modelo" name="modelo" value="EliteBook 840">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="cpu" class="form-label">CPU</label>
                                        <input type="text" class="form-control" id="cpu" name="cpu" value="Intel Core i7">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="ram" class="form-label">RAM</label>
                                        <input type="text" class="form-control" id="ram" name="ram" value="16GB DDR4">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="estado" class="form-label">Estado</label>
                                <select class="form-select" id="estado" name="estado">
                                    <option value="ACTIVO" selected>ACTIVO</option>
                                    <option value="MANTENIMIENTO">MANTENIMIENTO</option>
                                    <option value="BAJA">BAJA</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-success" id="btn-guardar-equipo">
                                <i class="fas fa-save me-2"></i>Actualizar Equipo
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Formulario de prueba para almacenamiento -->
                <div class="card mb-4">
                    <div class="card-header bg-secondary text-white">
                        <h5 class="mb-0"><i class="fas fa-hdd me-2"></i>Prueba - Editar Almacenamiento</h5>
                    </div>
                    <div class="card-body">
                        <form id="test-form-almacenamiento" data-tipo="almacenamiento">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="marca-alm" class="form-label">Marca</label>
                                        <input type="text" class="form-control" id="marca-alm" name="marca" value="Seagate">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="modelo-alm" class="form-label">Modelo</label>
                                        <input type="text" class="form-control" id="modelo-alm" name="modelo" value="Barracuda 1TB">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="tipo-alm" class="form-label">Tipo</label>
                                <select class="form-select" id="tipo-alm" name="tipo">
                                    <option value="HDD" selected>HDD</option>
                                    <option value="SSD">SSD</option>
                                    <option value="H铆brido">H铆brido</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Actualizar Dispositivo
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Formulario de prueba para videovigilancia -->
                <div class="card mb-4">
                    <div class="card-header bg-danger text-white">
                        <h5 class="mb-0"><i class="fas fa-video me-2"></i>Prueba - Editar Videovigilancia</h5>
                    </div>
                    <div class="card-body">
                        <form id="test-form-videovigilancia" data-tipo="videovigilancia">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="marca-cam" class="form-label">Marca</label>
                                        <input type="text" class="form-control" id="marca-cam" name="marca" value="Hikvision">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="modelo-cam" class="form-label">Modelo</label>
                                        <input type="text" class="form-control" id="modelo-cam" name="modelo" value="DS-2CD2043G0">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="ubicacion-cam" class="form-label">Ubicaci贸n</label>
                                <input type="text" class="form-control" id="ubicacion-cam" name="ubicacion" value="Pasillo Principal">
                            </div>
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-save me-2"></i>Guardar Cambios
                            </button>
                        </form>
                    </div>
                </div>

                <!-- Controles de prueba -->
                <div class="card">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-tools me-2"></i>Controles de Prueba</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-outline-primary w-100 mb-2" onclick="testNoChanges()">
                                    <i class="fas fa-check me-2"></i>Probar Sin Cambios
                                </button>
                                <button type="button" class="btn btn-outline-warning w-100 mb-2" onclick="makeChanges()">
                                    <i class="fas fa-edit me-2"></i>Simular Cambios
                                </button>
                                <button type="button" class="btn btn-outline-danger w-100 mb-2" onclick="testCancelConfirm()">
                                    <i class="fas fa-times me-2"></i>Probar Cancelar Confirmaci贸n
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn btn-outline-success w-100 mb-2" onclick="testConfirmSubmit()">
                                    <i class="fas fa-check-circle me-2"></i>Probar Confirmar Guardado
                                </button>
                                <button type="button" class="btn btn-outline-info w-100 mb-2" onclick="testCustomConfirm()">
                                    <i class="fas fa-cog me-2"></i>Configuraci贸n Personalizada
                                </button>
                                <button type="button" class="btn btn-outline-secondary w-100 mb-2" onclick="clearResults()">
                                    <i class="fas fa-trash me-2"></i>Limpiar Resultados
                                </button>
                            </div>
                        </div>
                        
                        <div id="test-results" class="mt-3"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="js/confirm-save.js"></script>
    <script src="js/edit-confirmations-config.js"></script>
    
    <script>
        // Simular URL para diferentes tipos de edici贸n
        function simulateUrl(type) {
            history.replaceState(null, null, `/site/${type}/editar/1`);
            // Reinicializar configuraciones
            if (typeof initCustomConfigurations === 'function') {
                initCustomConfigurations();
            }
        }

        // Probar sin cambios
        function testNoChanges() {
            addResult('info', 'Probando env铆o sin cambios...');
            document.getElementById('test-form-equipo').dispatchEvent(new Event('submit'));
        }

        // Simular cambios
        function makeChanges() {
            document.getElementById('marca').value = 'Dell (Modificado)';
            document.getElementById('cpu').value = 'Intel Core i9 (Modificado)';
            addResult('success', 'Cambios simulados en el formulario de equipos');
        }

        // Probar cancelar confirmaci贸n
        function testCancelConfirm() {
            makeChanges();
            addResult('warning', 'Haz clic en el bot贸n "Actualizar Equipo" y luego presiona "Cancelar" en la confirmaci贸n');
        }

        // Probar confirmar guardado
        function testConfirmSubmit() {
            makeChanges();
            addResult('info', 'Haz clic en el bot贸n "Actualizar Equipo" y luego presiona "S铆, guardar" en la confirmaci贸n');
        }

        // Probar confirmaci贸n personalizada
        function testCustomConfirm() {
            if (typeof ConfirmSave !== 'undefined') {
                ConfirmSave.setCustom('#test-form-equipo', {
                    title: ' Confirmaci贸n Ultra Personalizada',
                    text: 'Esta es una confirmaci贸n de prueba con dise帽o especial',
                    confirmButtonText: '<i class="fas fa-rocket me-2"></i>隆Enviar a la Luna!',
                    cancelButtonText: '<i class="fas fa-meteor me-2"></i>Mejor no',
                    confirmButtonColor: '#e83e8c',
                    cancelButtonColor: '#6c757d',
                    imageUrl: 'https://cdn-icons-png.flaticon.com/128/2784/2784403.png',
                    imageWidth: 80,
                    imageHeight: 80,
                    showCloseButton: true,
                    allowOutsideClick: false
                });
                addResult('success', 'Confirmaci贸n s煤per personalizada aplicada');
            }
        }

        // Limpiar resultados
        function clearResults() {
            document.getElementById('test-results').innerHTML = '';
        }

        // Agregar resultado de prueba
        function addResult(type, message) {
            const resultsDiv = document.getElementById('test-results');
            const alertClass = {
                'success': 'alert-success',
                'info': 'alert-info',
                'warning': 'alert-warning',
                'error': 'alert-danger'
            };
            
            const icon = {
                'success': 'check-circle',
                'info': 'info-circle',
                'warning': 'exclamation-triangle',
                'error': 'times-circle'
            };

            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${alertClass[type]} alert-dismissible fade show`;
            alertDiv.innerHTML = `
                <i class="fas fa-${icon[type]} me-2"></i>
                <strong>${new Date().toLocaleTimeString()}:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            resultsDiv.appendChild(alertDiv);
        }

        // Simular URLs para cada tipo al cargar
        document.addEventListener('DOMContentLoaded', function() {
            // Configurar listeners para los diferentes formularios
            document.getElementById('test-form-equipo').addEventListener('submit', function(e) {
                simulateUrl('equipo');
            });
            
            document.getElementById('test-form-almacenamiento').addEventListener('submit', function(e) {
                simulateUrl('almacenamiento');
            });
            
            document.getElementById('test-form-videovigilancia').addEventListener('submit', function(e) {
                simulateUrl('videovigilancia');
            });

            // Agregar listener para resultados de confirmaci贸n
            window.addEventListener('beforeunload', function(e) {
                addResult('warning', 'Evento beforeunload detectado - sistema funcionando');
            });

            addResult('success', 'P谩gina de pruebas cargada correctamente');
        });
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
